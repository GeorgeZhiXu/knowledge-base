name: Sync Secrets to Other Repos

on:
  workflow_dispatch:
    inputs:
      repos:
        description: 'Comma-separated list of repos (owner/repo format)'
        required: false
        default: 'GeorgeZhiXu/AiChatBot,GeorgeZhiXu/TingXieJs'

jobs:
  sync-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Sync Secrets
        env:
          GH_TOKEN: ${{ secrets.GH_PAT_TOKEN }}
        run: |
          # Define target repositories
          if [ -n "${{ github.event.inputs.repos }}" ]; then
            IFS=',' read -ra REPOS <<< "${{ github.event.inputs.repos }}"
          else
            REPOS=(
              "GeorgeZhiXu/AiChatBot"
              "GeorgeZhiXu/TingXieJs"
              # Add more repos here
            )
          fi

          # Secrets to sync
          declare -A secrets=(
            ["AWS_BEARER_TOKEN_BEDROCK"]="${{ secrets.AWS_BEARER_TOKEN_BEDROCK }}"
            ["MAC_MINI_HOST"]="${{ secrets.MAC_MINI_HOST }}"
            ["MAC_MINI_USER"]="${{ secrets.MAC_MINI_USER }}"
            ["MAC_MINI_SSH_KEY"]="${{ secrets.MAC_MINI_SSH_KEY }}"
            ["MAC_MINI_SSH_PORT"]="${{ secrets.MAC_MINI_SSH_PORT }}"
          )

          # Sync to each repo
          for repo in "${REPOS[@]}"; do
            echo "Syncing secrets to $repo..."
            for secret_name in "${!secrets[@]}"; do
              if [ -n "${secrets[$secret_name]}" ]; then
                gh secret set "$secret_name" \
                  --repo "$repo" \
                  --body "${secrets[$secret_name]}"
                echo "  âœ“ $secret_name"
              fi
            done
          done

          echo "Secret sync complete!"